# Print CRM Project Task Log

## Core Functionality (Planned / Implemented)

Ниже перечислены ключевые блоки функциональности для CRM типографии.

---

### 1. Basic application structure

* **Description:**  
  Базовый каркас приложения: backend на Node.js (Express + SQLite), frontend на Vue 3 (Vite), разделение на модули (Дэшборд, Заказы, Финансы, Склад и Закупка, Персонал, Аналитика, Справочники/Настройки).
* **Status:** Prototype implemented.

---

### 2. Authorization by access codes

* **Description:**  
  Авторизация без логинов и паролей — только по коду доступа.  
  - Таблица `users` с полями `name`, `role`, `access_code_hash`.  
  - 11 пользователей:  
    - Дизайнеры: Александр, Анастасия, Валентина, Юлия, Ольга  
    - Производство: Никита, Виктор, Павел, Екатерина  
    - Директор: Евгений  
    - Администратор: Андрей  
  - Экран входа: одно поле “Код доступа”.  
  - Backend: проверка кода, выдача токена и профиля пользователя.
* **Status:** Planned.

---

### 3. Header: greeting, name, motivation

* **Description:**  
  Хэдер с персонализацией для авторизованного пользователя:
  - Приветствие по времени суток:  
    - 05:00–11:59 — «Доброе утро, {Имя}!»
    - 12:00–17:59 — «Добрый день, {Имя}!»
    - 18:00–04:59 — «Добрый вечер, {Имя}!»
  - Имя пользователя, взятое из профиля.  
  - Случайная мотивационная фраза из набора (локально или из БД).  
  - Иконка уведомлений (кол-во непрочитанных событий).
* **Status:** Planned.

---

### 4. Dashboard (модульный дэшборд)

* **Description:**  
  Главная страница с настраиваемыми виджетами:
  - Мои активные заказы.  
  - Неоплаченные заказы.  
  - Ближайшие дедлайны.  
  - Заказы в производстве.  
  - Низкие остатки по складу.  
  - Выручка за день/месяц/год.  
  - Личная статистика (сколько заказов сделал сотрудник).  
  Каждый виджет можно включать/выключать и менять порядок. Возможность пресетов для разных ролей (дизайнер, производство, директор).
* **Status:** Planned.

---

### 5. Orders module + Calculator

* **Description:**  
  Центральный модуль работы с заказами:
  - Список заказов (табличный вид + фильтры: мои / все, статус, клиент, даты).  
  - Режим **канбан** с drag’n’drop между статусами: `draft`, `ready_for_prod`, `in_production`, `done`, `issued`, `canceled`.  
  - Карточка заказа:
    - Клиент / организация.  
    - Дедлайн (дата + время).  
    - Ответственный.  
    - Статус.  
    - Комментарии и файлы.  
  - **Удобный калькулятор заказа:**
    - Неограниченное число позиций.  
    - Выбор товара из базы `products` (категория, базовая цена, единица измерения).  
    - Автоприменение скидок за тираж по таблице `product_price_tiers`.  
    - Возможность ручной корректировки цены/скидки по позиции.  
    - Итоги: сумма по позициям, скидка на весь заказ, предоплата, остаток к оплате.  
  - Кнопка **«Отправить в производство»**:
    - Меняет статус заказа на `in_production`.  
    - Генерирует уведомления для всех пользователей из производства.  
    - Заказы появляются в списке/канбане у производства.
* **Status:** Planned (basic orders prototype may exist).

---

### 6. Finance / Cashbox

* **Description:**  
  Модуль для работы с оплатами:
  - Список неоплаченных / частично оплаченных заказов.  
  - Быстрый выбор способа оплаты (нал, карта, безнал, предоплата/доплата).  
  - Учёт оплат (`payments`) и кассовых смен (`cash_shifts`).  
  - Простейшие финансовые отчёты по дню/месяцу.  
  - Отображение и выгрузка отчётов (CSV/Excel).
* **Status:** Planned.

---

### 7. Warehouse & Purchase

* **Description:**  
  Общий модуль для склада и закупок:
  - Таблица материалов (`materials` + `warehouse_items`): остатки, минимальные уровни, единицы измерения.  
  - История движений (`warehouse_movements`): приход/расход, привязка к заказам.  
  - Автоматическое создание заявок на закупку (`purchase_requests`), если остаток ниже минимума.  
  - Вкладка **«Закупка»**:
    - Список всех заявок (автоматические + ручные).  
    - Статусы: `new`, `in_progress`, `ordered`, `received`.  
  - Связка с заказами (в будущем — “рецепты” материалов на единицу продукции и авто-списание при проведении заказа).
* **Status:** Planned.

---

### 8. Staff module

* **Description:**  
  Блок для управления персоналом:
  - Список сотрудников с ролями (дизайнер, производство, директор, админ).  
  - Графики работы, отпуска, больничные.  
  - Учёт приходов/уходов (чек-ин/чек-аут).  
  - Текущий статус: “На месте / Отсутствует”.  
  - Базовая статистика по производительности (кол-во заказов, просрочки).
* **Status:** Planned.

---

### 9. Analytics

* **Description:**  
  Раздел для анализа работы типографии:
  - Продажи: выручка по дням/месяцам, сравнение периодов, топ-клиенты и топ-продукты.  
  - Производство: среднее время выполнения заказов, просрочки, узкие места.  
  - Персонал: статистика по сотрудникам и отделам.  
  - Формирование отчётов (PDF/Excel) для директора/бухгалтерии.
* **Status:** Planned.

---

### 10. Directories & Settings (Справочники и настройки)

* **Description:**  
  Единое место настройки всех выпадающих списков и системных параметров:
  - Справочники:
    - Продукция, категории продукции.  
    - Материалы, единицы измерения.  
    - Статусы заказов.  
    - Способы оплаты.  
    - Отделы и должности.  
  - Настройки:
    - Маска телефона: формат `+7` и строго 10 цифр.  
    - Таблицы скидок за тиражность.  
    - Настройка прав доступа (индивидуальные ограничения).  
    - Пресеты виджетов дэшборда.  
    - Общие бизнес-настройки (налоги, валюта и т.п.).
* **Status:** Planned.

---

### 11. Permissions system (индивидуальные права)

* **Description:**  
  Гибкая система ограничений:
  - По умолчанию **все могут всё**.  
  - Таблица `user_permissions` хранит индивидуальные **запреты** (например, `orders.delete`, `orders.update_paid`, `warehouse.update_stock`, `finance.export`).  
  - Директор/админ настраивают права по каждому пользователю в UI.  
  - Backend проверяет права перед “опасными” действиями, фронт скрывает лишние кнопки.
* **Status:** Planned.

---

### 12. Notifications & Activity log

* **Description:**  
  - Таблица `notifications` + UI-колокольчик: новые заказы в производстве, изменения статуса, низкие остатки, важные события.  
  - Лог действий (кто поменял статус/сумму/удалил заказ) для директора/админа.
* **Status:** Planned.

---

### 13. UI/UX improvements & validation

* **Description:**  
  - Отказ от `alert` / `localhost says` в пользу встроенных UI-уведомлений (тосты, модалки).  
  - Маска телефона `+7XXXXXXXXXX` с ограничением длины.  
  - Единый стиль таблиц, форм, ошибок.  
  - Адаптивная верстка для разных экранов.
* **Status:** Planned.

---

## Project Tasks

### Phase 1: Core Skeleton & Basic Modules (In Progress)

- [v] Настроить backend на Node.js + Express + SQLite
- [v] Настроить frontend на Vue 3 + Vite.
- [v] Вынести конфигурацию в `.env` (порт, путь к БД, CORS).
- [v] Настроить базовые API-модули: `clients`, `orders`, `products`.
- [v] Добавить миграции и сиды для основных таблиц.

---

### Phase 2: Authorization & Header Personalization

- [v] Реализовать модель `users` с полями `name`, `role`, `access_code_hash`.
- [v] Добавить 11 сотрудников (дизайнеры, производство, директор, админ) в сиды.
- [v] Сделать экран авторизации по коду доступа (без логина/пароля).
- [v] Реализовать выдачу и проверку токена (JWT или сессии).
- [v] Сформировать в хэдере приветствие по времени суток + имя + мотивационная фраза.
- [v] Добавить иконку уведомлений и счётчик непрочитанных.

---

### Phase 3: Orders & Calculator

- [ ] Реализовать сущности `products`, `product_categories`.
- [ ] Реализовать модель `product_price_tiers` (скидки/цены по тиражам).
- [ ] Реализовать список заказов с фильтрами (мои / все, статус, даты, клиент).
- [ ] Реализовать карточку заказа с:
  - [ ] таблицей позиций,
  - [ ] расчётом цен и скидок,
  - [ ] итогами по заказу.
- [ ] Реализовать переключение список ↔ канбан с drag’n’drop по статусам.
- [ ] Реализовать кнопку “Отправить в производство” + изменение статуса.
- [ ] Сгенерировать уведомления для производства при отправке в работу.

---

### Phase 4: Finance / Cashbox

- [ ] Реализовать `payments` и `cash_shifts`.
- [ ] Добавить раздел “Касса” со списком неоплаченных заказов.
- [ ] Реализовать проведение оплат (нал, карта, безнал, предоплата/доплата).
- [ ] Добавить отчёт по смене (итоги дня).
- [ ] Настроить выгрузку финансовых отчётов (CSV/Excel).

---

### Phase 5: Warehouse & Purchase

- [ ] Реализовать сущности `materials`, `warehouse_items`, `warehouse_movements`.
- [ ] Добавить раздел “Склад” с остатками и минимальными уровнями.
- [ ] Реализовать автосоздание `purchase_requests` при низких остатках.
- [ ] Добавить вкладку “Закупка” со списком заявок и статусами.
- [ ] Связать расход материалов с заказами (первый вариант — ручной, затем авто).

---

### Phase 6: Staff & Analytics

- [ ] Создать таблицы для персонала (`staff`, `staff_schedule`, `staff_attendance`).
- [ ] Раздел “Персонал”: список сотрудников, статусы, графики.
- [ ] Базовая аналитика по людям (кол-во заказов, просрочки).
- [ ] Раздел “Аналитика”: графики выручки, топ-клиенты/продукты, сравнение периодов.
- [ ] Отчёты для директора с возможностью выгрузки.
- [ ] Персональные рекомендации исходя из статистики. 

---

### Phase 7: Permissions & Hardening

- [ ] Реализовать таблицу `user_permissions` (индивидуальные запреты).
- [ ] Добавить раздел “Права доступа” в настройках.
- [ ] Подключить middleware для проверки прав на backend.
- [ ] Скрывать недоступные действия на фронте.
- [ ] Улучшить обработку ошибок и пользовательские сообщения (тосты/модалки вместо alert).

---

### Phase 8: UI & UX Polishing

- [ ] Разработать базовую дизайн-систему:
  - [ ] Цветовая палитра (основной цвет, акцентные, фон, ошибки/успех).
  - [ ] Типографика (размеры заголовков, текста, подписи, моноширинный текст).
  - [ ] Единые отступы, радиусы, тени, сетка.

- [ ] Унифицировать компоненты интерфейса:
  - [ ] Кнопки (основная, вторичная, опасная, отключённая).
  - [ ] Поля ввода (инпуты, селекты, чекбоксы, радиокнопки).
  - [ ] Таблицы (шапка, ховер, выбранная строка, пагинация).
  - [ ] Модальные окна, боковые панели, тост-уведомления.

- [ ] Состояния интерфейса:
  - [ ] Состояния загрузки (спиннеры/скелетоны для таблиц и форм).
  - [ ] Состояния ошибок (понятные сообщения, что делать дальше).
  - [ ] Пустые состояния (нет заказов, нет уведомлений, нет материалов).
  - [ ] Подтверждения для опасных действий (удаление, отмена заказа).

- [ ] UI-уведомления:
  - [ ] Полностью уйти от `alert` / `localhost says`.
  - [ ] Ввести единый компонент тостов/баннеров для ошибок/успеха/инфо.
  - [ ] Единое место управления текстами сообщений.

- [ ] Улучшение UX ключевых сценариев:
  - [ ] Создание/редактирование заказа с калькулятором (минимум кликов, подсказки).
  - [ ] Отправка заказа в производство (понятный flow, явное подтверждение).
  - [ ] Работа с кассой (чёткая сумма к оплате, понятные статусы).
  - [ ] Склад и Закупка (где я сейчас? что нужно сделать? что критично?).
  - [ ] Поиск и фильтры (сохранение выбранных фильтров, быстрый сброс).

- [ ] Ролевые интерфейсы:
  - [ ] Настроить виджеты и приоритеты для каждого типа пользователя:
    - [ ] Дизайнер — фокус на заказах, калькуляторе, дедлайнах.
    - [ ] Производство — очередь работ, статусы, новые заказы.
    - [ ] Директор — аналитика, финансы, общая загрузка.
    - [ ] Админ — настройки, пользователи, права.
  - [ ] Убедиться, что каждый “видит главное” за 3–5 секунд.

- [ ] Адаптивность и масштабирование:
  - [ ] Проверить работу на разных разрешениях (ноут, большой монитор).
  - [ ] Корректная работа при масштабировании браузера (90–125%).

- [ ] Микро-анимации и плавность:
  - [ ] Плавные переходы при открытии модалок, смене вкладок, drag’n’drop в канбане.
  - [ ] Без перегруза — анимации только там, где помогают понять действие.

- [ ] Юзабилити-ревизия:
  - [ ] Пройтись по основным сценариям глазами каждого типа сотрудника.
  - [ ] Собрать фидбек команды (дизайнеры, производство, директор, админ).
  - [ ] Внести финальные правки в тексты, подписи, расположение кнопок.

---

### Testing

- [ ] Написать базовые автотесты для backend API (заказы, авторизация, склад).
- [ ] Написать smoke-тесты для фронтенд-форм (создание заказа, калькулятор, авторизация).
- [ ] Протестировать сценарий “Дизайнер → Производство → Касса → Архив”.
- [ ] Протестировать работу маски телефона и валидации данных.
- [ ] Протестировать права доступа: ограниченные пользователи не могут выполнять запрещённые действия.

---

Этот лог можно использовать как живой документ: отмечать выполненные задачи, добавлять новые фичи и фиксировать состояние проекта по фазам.
